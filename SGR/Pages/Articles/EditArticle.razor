@page "/editArticle/{ID}" //También "/editArticle/{ID:int}" Ver - > https://docs.microsoft.com/en-us/aspnet/core/blazor/routing?view=aspnetcore-3.1
@using Microsoft.AspNetCore.Components
@inject IManager<Article> articleManager
@inject IManager<Category> categoryManager
@inject NavigationManager navigationManager

<h2>
    Edit Article: <b>@article.Title</b>
</h2>

<div class="row">
    <div class="col-md-4">
        <EditForm Model="article"
                  OnValidSubmit="UpdateArticle">
            <div class="form-group">
                <label for="Name" class="control-label">Name</label>
                <input for="Name" class="form-control" @bind="article.Title" />

                <label for="Name" class="control-label">Category</label>
                <select class="form-control" @bind="SelectedCategory">
                    @foreach (var category in categories)
                    {
                        <option value="@category.IdCategory">@category.Name</option>
                    }
                </select>

                <input type="hidden" @bind="@article.IdArticle" />
                <DataAnnotationsValidator></DataAnnotationsValidator>
                <ValidationSummary></ValidationSummary>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-danger" @onclick="() => Cancel()">Cancel</button>
            </div>
        </EditForm>
    </div>
</div>

@code  {

    [Parameter]
    public string ID { get; set; }

    Article article = new Article();
    public int SelectedCategory { get; set; }
    IList<Category> categories;

    protected override async Task OnInitializedAsync()
    {
        
        article = await articleManager.GetById(Convert.ToInt32(ID));
        SelectedCategory = article.Category.IdCategory;
        categories = await categoryManager.ListAll();
    }

    protected async Task UpdateArticle()
    {
        article.Category.IdCategory = SelectedCategory;
        await articleManager.Update(article);
        navigationManager.NavigateTo("/articlelist");
    }

    void Cancel()
    {
        navigationManager.NavigateTo("/articlelist");
    }
}
